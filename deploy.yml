variables:
  packagePath: '$(System.DefaultWorkingDirectory)/function.zip'  # zip will be at root

steps:
- task: NodeTool@0
  inputs:
    versionSpec: '18.x'
  displayName: 'Install Node.js'

- script: |
    npm install
  displayName: 'Install dependencies'

- script: |
    zip -r function.zip .
  displayName: 'Zip Function App'

- task: AzureFunctionApp@1
  inputs:
    azureSubscription: $(azureSubscription)
    appType: 'functionApp'
    appName: $(functionAppName)
    resourceGroupName: $(resourceGroupName)
    package: $(packagePath)
    enableManagedIdentity: true
    deploymentMethod: 'zipDeploy'
